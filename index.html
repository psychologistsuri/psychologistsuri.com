<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Surendra Bisht</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

    <style>
      .proseish h1 {
        font-size: 1.9rem;
        font-weight: 700;
        margin: 1.5rem 0;
      }
      .proseish h2 {
        font-size: 1.4rem;
        font-weight: 700;
        margin: 1.2rem 0;
      }
      .proseish h3 {
        font-size: 1.15rem;
        font-weight: 700;
        margin: 1rem 0;
      }
      .proseish p {
        margin: 0.75rem 0;
      }
      .proseish ul {
        list-style: disc;
        padding-left: 1.2rem;
      }
      .proseish blockquote {
        border-left: 3px solid #ddd;
        padding-left: 1rem;
        margin: 1rem 0;
      }
      .dark .proseish blockquote {
        border-left-color: #444;
      }
    </style>
  </head>

  <body class="bg-white text-zinc-900 dark:bg-zinc-950 dark:text-zinc-100">
    <header class="border-b border-zinc-200 dark:border-zinc-800">
      <div
        class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center"
      >
        <a href="/" class="font-semibold text-lg">Surendra Bisht</a>

        <div class="flex items-center gap-4">
          <a href="/" class="text-sm text-zinc-600 dark:text-zinc-300">
            Articles
          </a>
          <a
            href="#"
            id="aboutLink"
            class="text-sm text-zinc-600 dark:text-zinc-300"
          >
            About
          </a>
          <button
            id="themeToggle"
            class="rounded-full border px-3 py-1.5 text-sm"
          >
            Light
          </button>
        </div>
      </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-10">
      <section id="listView">
        <div class="flex justify-between items-start">
          <div>
            <h1 class="text-3xl font-bold">Articles</h1>
            <p class="text-zinc-600 dark:text-zinc-300 mt-1">
              Applied psychology, education, and inclusive practice
            </p>
          </div>

          <input
            id="search"
            placeholder="Search"
            class="rounded-full border px-4 py-2 text-sm bg-white dark:bg-zinc-900"
          />
        </div>

        <div id="articleList" class="mt-8 grid gap-3"></div>
      </section>

      <section id="articleView" class="hidden">
        <a
          href="/"
          class="text-sm text-zinc-600 dark:text-zinc-300"
        >
          Back
        </a>
        <h1 id="articleTitle" class="text-3xl font-bold mt-4"></h1>
        <div id="articleBody" class="proseish mt-6"></div>
      </section>

      <section id="aboutView" class="hidden">
        <a
          href="/"
          class="text-sm text-zinc-600 dark:text-zinc-300"
        >
          Back
        </a>

        <div class="mt-6 rounded-3xl border p-6">
          <h2 class="text-2xl font-bold">About</h2>
          <p class="mt-2">
            Special Educator and School Counselor, Applied Psychology and Special
            Education
          </p>
          <div class="mt-3 text-sm">Stone Mountain, Georgia</div>
          <div class="text-sm">Psychologist.suri@gmail.com</div>
        </div>
      </section>
    </main>

    <script>
      const INDEX = "/articles/index.json";
      const BASE = "/articles/";
      const THEME = "ps_theme";

      function qs(s) {
        return document.querySelector(s);
      }
      function show(x) {
        x.classList.remove("hidden");
      }
      function hide(x) {
        x.classList.add("hidden");
      }

      function setTheme(t) {
        document.documentElement.classList.toggle("dark", t === "dark");
        qs("#themeToggle").textContent = t === "dark" ? "Dark" : "Light";
      }

      function initTheme() {
        const s = localStorage.getItem(THEME);
        setTheme(s || "light");
      }

      qs("#themeToggle").onclick = () => {
        const d = document.documentElement.classList.contains("dark");
        const t = d ? "light" : "dark";
        localStorage.setItem(THEME, t);
        setTheme(t);
      };

      async function getFiles() {
        const r = await fetch(INDEX);
        return (await r.json()).files;
      }

      function getTitle(md) {
        const l = md.split("\n").find((x) => x.trim());
        return l?.replace("#", "").trim();
      }

      async function load() {
        const files = await getFiles();
        const list = [];

        for (const f of files) {
          const md = await fetch(BASE + f).then((r) => r.text());
          list.push({ file: f, title: getTitle(md), md });
        }

        renderList(list);
      }

      function renderList(items) {
        const c = qs("#articleList");
        c.innerHTML = "";

        items.forEach((i) => {
          const a = document.createElement("a");
          a.href = "/?a=" + i.file;
          a.className =
            "rounded-3xl border p-5 hover:bg-zinc-50 dark:hover:bg-zinc-900";
          a.textContent = i.title;
          c.appendChild(a);
        });
      }

      function route() {
        const params = new URLSearchParams(location.search);
        const a = params.get("a");
        const about = params.get("about");

        hide(qs("#listView"));
        hide(qs("#articleView"));
        hide(qs("#aboutView"));

        if (about) {
          show(qs("#aboutView"));
          return;
        }

        if (a) {
          show(qs("#articleView"));
          fetch(BASE + a)
            .then((r) => r.text())
            .then((md) => {
              qs("#articleTitle").textContent = getTitle(md);
              qs("#articleBody").innerHTML = marked.parse(md);
            });
          return;
        }

        show(qs("#listView"));
        load();
      }

      qs("#aboutLink").onclick = (e) => {
        e.preventDefault();
        history.pushState({}, "", "/?about=1");
        route();
      };

      window.onpopstate = route;

      initTheme();
      route();
    </script>
  </body>
</html>
